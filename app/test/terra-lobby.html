<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>terra-lobby</title>

  <script src="../bower_components/webcomponentsjs/webcomponents.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>

  <!-- Step 1: import the element to test -->
  <link rel="import" href="../elements/terra-lobby/terra-lobby.html">

</head>
<body>

  <terra-lobby id="fixture1" players="3"></terra-lobby>

  <div id="fixture2">
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
      <terra-lobby players="5"></terra-lobby><terra-lobby players="5"></terra-lobby>
  </div>

  <script>
    function uniq(a) {
      var seen = {};
      return a.filter(function(item) {
          return seen.hasOwnProperty(item) ? false : (seen[item] = true);
      });
    }

    suite('terra-lobby', function() {
        test('Item lengths should be equalled', function(done) {
            var el = document.querySelector('#fixture1');

            flush(function() {
                var listItems = el.shadowRoot.querySelectorAll('terra-lobby-item');
                assert.equal(listItems.length, 3);
                done();
            });
        });

        test('Colors should be unique', function(done) {
            var el = document.querySelector('#fixture2');

            flush(function() {
                var lobbies = el.querySelectorAll('terra-lobby'),
                    lobbiesLength = lobbies.length,
                    lobbyItems,
                    colors,
                    uniqueColors,
                    i;

                for (i = 0; i < lobbiesLength; i++) {
                    lobbyItems = lobbies[i].shadowRoot.querySelectorAll('terra-lobby-item');

                    colors = Array.prototype.slice.call(lobbyItems).map(function (item) {
                        return item.faction.color;
                    });
                    uniqueColors = uniq(colors);

                    assert.equal(colors.length, uniqueColors.length);
                }
                done();
            });
        })
    });
  </script>

</body>
</html>
